<app-lecturer-layout>
  <!-- Dashboard Content -->
  <div class="dashboard-content">
    <!-- Page Header -->
    <div class="page-header">
      <h1>Lecturer Dashboard</h1>
      <p>Welcome back! Here's your teaching overview and student progress.</p>
    </div>
    
    <!-- Loading Spinner -->
    <div *ngIf="loading" class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading dashboard data...</p>
    </div>

    <!-- Dashboard Content -->
    <div *ngIf="!loading && dashboardStats">
      <!-- Stats Cards -->
      <div class="stats-grid">
        <!-- Subjects Card -->
        <mat-card class="stat-card" style="border-left: 4px solid #9C27B0">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon" style="background-color: #9C27B0">
                <mat-icon>class</mat-icon>
              </div>
              <div class="stat-info">
                <h2>{{ dashboardStats.subjectCount }}</h2>
                <p>Total Subjects</p>
                <span class="stat-growth" style="color: #9C27B0">Teaching now</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Courses Card -->
        <mat-card class="stat-card" style="border-left: 4px solid #2196F3">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon" style="background-color: #2196F3">
                <mat-icon>library_books</mat-icon>
              </div>
              <div class="stat-info">
                <h2>{{ dashboardStats.courseCount }}</h2>
                <p>Active Courses</p>
                <span class="stat-growth" style="color: #2196F3">{{ dashboardStats.batchCount }} batches</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Assignments Card -->
        <mat-card class="stat-card" style="border-left: 4px solid #FF9800">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon" style="background-color: #FF9800">
                <mat-icon>assignment</mat-icon>
              </div>
              <div class="stat-info">
                <h2>{{ dashboardStats.assignmentStats.total }}</h2>
                <p>Total Assignments</p>
                <span class="stat-growth" style="color: #FF9800">
                  {{ dashboardStats.assignmentStats.pending }} pending
                </span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Meetings Card -->
        <mat-card class="stat-card" style="border-left: 4px solid #4CAF50">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon" style="background-color: #4CAF50">
                <mat-icon>video_call</mat-icon>
              </div>
              <div class="stat-info">
                <h2>{{ dashboardStats.meetingStats.total }}</h2>
                <p>Total Meetings</p>
                <span class="stat-growth" style="color: #4CAF50">
                  {{ dashboardStats.meetingStats.scheduled }} scheduled
                </span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Assignment & Meeting Breakdown Cards -->
      <div class="breakdown-grid">
        <!-- Assignment Breakdown -->
        <mat-card class="breakdown-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>assignment_turned_in</mat-icon>
              Assignment Overview
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="breakdown-stats">
              <div class="breakdown-item">
                <div class="breakdown-icon total">
                  <mat-icon>assignment</mat-icon>
                </div>
                <div class="breakdown-info">
                  <h3>{{ dashboardStats.assignmentStats.total }}</h3>
                  <p>Total Assignments</p>
                </div>
              </div>
              <div class="breakdown-item">
                <div class="breakdown-icon pending">
                  <mat-icon>schedule</mat-icon>
                </div>
                <div class="breakdown-info">
                  <h3>{{ dashboardStats.assignmentStats.pending }}</h3>
                  <p>Pending</p>
                </div>
              </div>
              <div class="breakdown-item">
                <div class="breakdown-icon completed">
                  <mat-icon>check_circle</mat-icon>
                </div>
                <div class="breakdown-info">
                  <h3>{{ dashboardStats.assignmentStats.completed }}</h3>
                  <p>Completed</p>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Meeting Breakdown -->
        <mat-card class="breakdown-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>video_library</mat-icon>
              Meeting Overview
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="breakdown-stats">
              <div class="breakdown-item">
                <div class="breakdown-icon total">
                  <mat-icon>video_call</mat-icon>
                </div>
                <div class="breakdown-info">
                  <h3>{{ dashboardStats.meetingStats.total }}</h3>
                  <p>Total Meetings</p>
                </div>
              </div>
              <div class="breakdown-item">
                <div class="breakdown-icon scheduled">
                  <mat-icon>event</mat-icon>
                </div>
                <div class="breakdown-info">
                  <h3>{{ dashboardStats.meetingStats.scheduled }}</h3>
                  <p>Scheduled</p>
                </div>
              </div>
              <div class="breakdown-item">
                <div class="breakdown-icon ongoing">
                  <mat-icon>play_circle</mat-icon>
                </div>
                <div class="breakdown-info">
                  <h3>{{ dashboardStats.meetingStats.ongoing }}</h3>
                  <p>Ongoing</p>
                </div>
              </div>
              <div class="breakdown-item">
                <div class="breakdown-icon completed">
                  <mat-icon>done_all</mat-icon>
                </div>
                <div class="breakdown-info">
                  <h3>{{ dashboardStats.meetingStats.completed }}</h3>
                  <p>Completed</p>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Subject Details Section -->
      <mat-card class="subject-details-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>school</mat-icon>
            My Subjects Details
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <!-- Loading Spinner for Subjects -->
          <div *ngIf="loadingSubjects" class="loading-container">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Loading subject details...</p>
          </div>

          <!-- Subject Details Table -->
          <div *ngIf="!loadingSubjects && subjectDetails.length > 0" class="table-container">
            <table mat-table [dataSource]="subjectDetails" class="subject-table">
              
              <!-- Subject Column -->
              <ng-container matColumnDef="subject">
                <th mat-header-cell *matHeaderCellDef>Subject</th>
                <td mat-cell *matCellDef="let element">
                  <div class="subject-cell">
                    <strong>{{ element.name }}</strong>
                    <span class="subject-code">{{ element.code }}</span>
                  </div>
                </td>
              </ng-container>

              <!-- Course Column -->
              <ng-container matColumnDef="course">
                <th mat-header-cell *matHeaderCellDef>Course & Batch</th>
                <td mat-cell *matCellDef="let element">
                  <div class="course-cell">
                    <span>{{ element.course.name }}</span>
                    <span class="batch-info">{{ element.batch.name }} ({{ element.batch.startYear }}-{{ element.batch.endYear }})</span>
                  </div>
                </td>
              </ng-container>

              <!-- Batch/Semester Column -->
              <ng-container matColumnDef="batch">
                <th mat-header-cell *matHeaderCellDef>Semester</th>
                <td mat-cell *matCellDef="let element">
                  <mat-chip class="semester-chip">{{ element.semester.name }}</mat-chip>
                </td>
              </ng-container>

              <!-- Modules Column -->
              <ng-container matColumnDef="modules">
                <th mat-header-cell *matHeaderCellDef>Modules</th>
                <td mat-cell *matCellDef="let element">
                  <div class="stat-badge modules">
                    <mat-icon>menu_book</mat-icon>
                    <span>{{ element.statistics.moduleCount }}</span>
                  </div>
                </td>
              </ng-container>

              <!-- Assignments Column -->
              <ng-container matColumnDef="assignments">
                <th mat-header-cell *matHeaderCellDef>Assignments</th>
                <td mat-cell *matCellDef="let element">
                  <div class="stat-group">
                    <div class="stat-badge assignments">
                      <mat-icon>assignment</mat-icon>
                      <span>{{ element.statistics.assignmentCount }}</span>
                    </div>
                    <div class="sub-stats">
                      <span class="pending">{{ element.statistics.assignmentBreakdown.pending }} pending</span>
                      <span class="completed">{{ element.statistics.assignmentBreakdown.completed }} done</span>
                    </div>
                  </div>
                </td>
              </ng-container>

              <!-- Meetings Column -->
              <ng-container matColumnDef="meetings">
                <th mat-header-cell *matHeaderCellDef>Meetings</th>
                <td mat-cell *matCellDef="let element">
                  <div class="stat-group">
                    <div class="stat-badge meetings">
                      <mat-icon>video_call</mat-icon>
                      <span>{{ element.statistics.meetingCount }}</span>
                    </div>
                    <div class="sub-stats">
                      <span class="scheduled">{{ element.statistics.meetingBreakdown.scheduled }} scheduled</span>
                      <span class="completed">{{ element.statistics.meetingBreakdown.completed }} done</span>
                    </div>
                  </div>
                </td>
              </ng-container>

              <!-- Students Column -->
              <ng-container matColumnDef="students">
                <th mat-header-cell *matHeaderCellDef>Students</th>
                <td mat-cell *matCellDef="let element">
                  <div class="stat-badge students">
                    <mat-icon>people</mat-icon>
                    <span>{{ element.statistics.studentCount }}</span>
                  </div>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="subject-row"></tr>
            </table>
          </div>

          <!-- No Subjects Message -->
          <div *ngIf="!loadingSubjects && subjectDetails.length === 0" class="no-data">
            <mat-icon>info</mat-icon>
            <p>No subjects assigned yet</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- No Data Message -->
    <div *ngIf="!loading && !dashboardStats" class="no-data">
      <mat-icon>info</mat-icon>
      <p>No dashboard data available</p>
    </div>
  </div>
</app-lecturer-layout>
