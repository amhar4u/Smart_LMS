<div class="assignments-list-container">
  <!-- Filters -->
  <mat-card class="filters-card">
    <div class="filters-header">
      <mat-icon>filter_list</mat-icon>
      <h3>Filter Assignments</h3>
    </div>

    <form [formGroup]="filterForm" class="filters-form">
      <div class="filters-grid">
        <!-- Subject Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Subject</mat-label>
          <mat-select formControlName="subject">
            <mat-option value="">All Subjects</mat-option>
            <mat-option *ngFor="let subject of subjects" [value]="subject._id">
              {{ subject.name }}
            </mat-option>
          </mat-select>
          <mat-icon matPrefix>class</mat-icon>
        </mat-form-field>

        <!-- Assignment Level Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Level</mat-label>
          <mat-select formControlName="assignmentLevel">
            <mat-option value="">All Levels</mat-option>
            <mat-option value="easy">Easy</mat-option>
            <mat-option value="medium">Medium</mat-option>
            <mat-option value="hard">Hard</mat-option>
          </mat-select>
          <mat-icon matPrefix>trending_up</mat-icon>
        </mat-form-field>

        <!-- Assignment Type Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Type</mat-label>
          <mat-select formControlName="assignmentType">
            <mat-option value="">All Types</mat-option>
            <mat-option value="MCQ">Multiple Choice</mat-option>
            <mat-option value="short_answer">Short Answer</mat-option>
            <mat-option value="essay">Essay</mat-option>
          </mat-select>
          <mat-icon matPrefix>assignment</mat-icon>
        </mat-form-field>

        <!-- Status Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Status</mat-label>
          <mat-select formControlName="isActive">
            <mat-option value="">All Statuses</mat-option>
            <mat-option value="true">Active</mat-option>
            <mat-option value="false">Inactive</mat-option>
          </mat-select>
          <mat-icon matPrefix>toggle_on</mat-icon>
        </mat-form-field>
      </div>

      <div class="filters-actions">
        <button mat-stroked-button (click)="clearFilters()" type="button">
          <mat-icon>clear</mat-icon>
          Clear Filters
        </button>
        <span class="results-count">{{ totalAssignments }} assignment(s) found</span>
      </div>
    </form>
  </mat-card>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading assignments...</p>
  </div>

  <!-- Assignments Table -->
  <mat-card *ngIf="!loading" class="table-card">
    <div class="table-container">
      <table mat-table [dataSource]="assignments" class="assignments-table">
        <!-- Title Column -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>Assignment</th>
          <td mat-cell *matCellDef="let assignment">
            <div class="assignment-title">
              <strong>{{ assignment.title }}</strong>
              <small>{{ assignment.description | slice:0:60 }}{{ assignment.description.length > 60 ? '...' : '' }}</small>
            </div>
          </td>
        </ng-container>

        <!-- Subject Column -->
        <ng-container matColumnDef="subject">
          <th mat-header-cell *matHeaderCellDef>Subject</th>
          <td mat-cell *matCellDef="let assignment">
            <div class="subject-info">
              <span class="subject-name">{{ assignment.subject?.name }}</span>
              <span class="subject-code">{{ assignment.subject?.code }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Batch Column -->
        <ng-container matColumnDef="batch">
          <th mat-header-cell *matHeaderCellDef>Batch</th>
          <td mat-cell *matCellDef="let assignment">
            {{ assignment.batch?.name }}
          </td>
        </ng-container>

        <!-- Type Column -->
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>Type</th>
          <td mat-cell *matCellDef="let assignment">
            <mat-chip [class]="getTypeBadgeClass(assignment.assignmentType)">
              {{ assignment.assignmentType === 'MCQ' ? 'MCQ' : assignment.assignmentType === 'short_answer' ? 'Short Answer' : 'Essay' }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Level Column -->
        <ng-container matColumnDef="level">
          <th mat-header-cell *matHeaderCellDef>Level</th>
          <td mat-cell *matCellDef="let assignment">
            <mat-chip [class]="getLevelBadgeClass(assignment.assignmentLevel)">
              {{ assignment.assignmentLevel | titlecase }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Due Date Column -->
        <ng-container matColumnDef="dueDate">
          <th mat-header-cell *matHeaderCellDef>Due Date</th>
          <td mat-cell *matCellDef="let assignment">
            <div class="date-cell">
              <mat-icon>event</mat-icon>
              <span>{{ formatDate(assignment.dueDate) }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Questions Column -->
        <ng-container matColumnDef="questions">
          <th mat-header-cell *matHeaderCellDef>Questions</th>
          <td mat-cell *matCellDef="let assignment">
            <div class="count-cell">
              <mat-icon>help_outline</mat-icon>
              <span>{{ assignment.numberOfQuestions }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Marks Column -->
        <ng-container matColumnDef="marks">
          <th mat-header-cell *matHeaderCellDef>Max Marks</th>
          <td mat-cell *matCellDef="let assignment">
            <div class="marks-cell">
              <strong>{{ assignment.maxMarks }}</strong>
            </div>
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let assignment">
            <mat-chip [class]="getStatusClass(assignment)">
              {{ getStatusLabel(assignment) }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let assignment">
            <div class="action-buttons">
              <button mat-icon-button [matTooltip]="'View Details'" (click)="viewAssignment(assignment)">
                <mat-icon>visibility</mat-icon>
              </button>
              <button mat-icon-button [matTooltip]="'View Submissions'" (click)="viewSubmissions(assignment)" color="primary">
                <mat-icon>upload_file</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
      </table>

      <!-- No Data -->
      <div *ngIf="assignments.length === 0 && !loading" class="no-data">
        <mat-icon>assignment</mat-icon>
        <h3>No assignments found</h3>
        <p>There are no assignments matching your filters.</p>
      </div>
    </div>

    <!-- Paginator -->
    <mat-paginator
      [length]="totalAssignments"
      [pageSize]="pageSize"
      [pageSizeOptions]="[5, 10, 25, 50]"
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
  </mat-card>
</div>
