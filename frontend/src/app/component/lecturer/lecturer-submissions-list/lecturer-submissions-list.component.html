<div class="submissions-list-container">
  <!-- Statistics Cards -->
  <div *ngIf="statistics" class="statistics-grid">
    <mat-card class="stat-card total">
      <mat-icon>upload_file</mat-icon>
      <div class="stat-content">
        <span class="stat-number">{{ statistics.totalSubmissions }}</span>
        <span class="stat-label">Total Submissions</span>
      </div>
    </mat-card>

    <mat-card class="stat-card evaluated">
      <mat-icon>check_circle</mat-icon>
      <div class="stat-content">
        <span class="stat-number">{{ statistics.evaluated }}</span>
        <span class="stat-label">Evaluated</span>
      </div>
    </mat-card>

    <mat-card class="stat-card pending">
      <mat-icon>pending</mat-icon>
      <div class="stat-content">
        <span class="stat-number">{{ statistics.pending }}</span>
        <span class="stat-label">Pending</span>
      </div>
    </mat-card>

    <mat-card class="stat-card average">
      <mat-icon>analytics</mat-icon>
      <div class="stat-content">
        <span class="stat-number">{{ statistics.avgPercentage?.toFixed(1) || 0 }}%</span>
        <span class="stat-label">Average Score</span>
      </div>
    </mat-card>
  </div>

  <!-- Filters -->
  <mat-card class="filters-card">
    <div class="filters-header">
      <mat-icon>filter_list</mat-icon>
      <h3>Filter Submissions</h3>
    </div>

    <form [formGroup]="filterForm" class="filters-form">
      <div class="filters-grid">
        <!-- Subject Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Subject</mat-label>
          <mat-select formControlName="subject">
            <mat-option value="">All Subjects</mat-option>
            <mat-option *ngFor="let subject of subjects" [value]="subject._id">
              {{ subject.name }}
            </mat-option>
          </mat-select>
          <mat-icon matPrefix>class</mat-icon>
        </mat-form-field>

        <!-- Assignment Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Assignment</mat-label>
          <mat-select formControlName="assignment">
            <mat-option value="">All Assignments</mat-option>
            <mat-option *ngFor="let assignment of assignments" [value]="assignment._id">
              {{ assignment.title }}
            </mat-option>
          </mat-select>
          <mat-icon matPrefix>assignment</mat-icon>
        </mat-form-field>

        <!-- Evaluation Status Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Evaluation Status</mat-label>
          <mat-select formControlName="evaluationStatus">
            <mat-option value="">All Statuses</mat-option>
            <mat-option value="pending">Pending</mat-option>
            <mat-option value="evaluating">Evaluating</mat-option>
            <mat-option value="completed">Evaluated</mat-option>
            <mat-option value="failed">Failed</mat-option>
          </mat-select>
          <mat-icon matPrefix>checklist</mat-icon>
        </mat-form-field>

        <!-- Level Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Performance Level</mat-label>
          <mat-select formControlName="level">
            <mat-option value="">All Levels</mat-option>
            <mat-option value="beginner">Beginner</mat-option>
            <mat-option value="intermediate">Intermediate</mat-option>
            <mat-option value="advanced">Advanced</mat-option>
          </mat-select>
          <mat-icon matPrefix>trending_up</mat-icon>
        </mat-form-field>

        <!-- Search -->
        <mat-form-field appearance="outline">
          <mat-label>Search Student</mat-label>
          <input matInput formControlName="search" placeholder="Name, email, or ID">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>
      </div>

      <div class="filters-actions">
        <button mat-stroked-button (click)="clearFilters()" type="button">
          <mat-icon>clear</mat-icon>
          Clear Filters
        </button>
        <span class="results-count">{{ totalSubmissions }} submission(s) found</span>
      </div>
    </form>
  </mat-card>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading submissions...</p>
  </div>

  <!-- Submissions Table -->
  <mat-card *ngIf="!loading" class="table-card">
    <div class="table-container">
      <table mat-table [dataSource]="submissions" class="submissions-table">
        <!-- Student Column -->
        <ng-container matColumnDef="student">
          <th mat-header-cell *matHeaderCellDef>Student</th>
          <td mat-cell *matCellDef="let submission">
            <div class="student-info">
              <strong>{{ getStudentName(submission) }}</strong>
              <small>{{ getStudentId(submission) }}</small>
              <small class="email">{{ submission.studentId?.email }}</small>
            </div>
          </td>
        </ng-container>

        <!-- Assignment Column -->
        <ng-container matColumnDef="assignment">
          <th mat-header-cell *matHeaderCellDef>Assignment</th>
          <td mat-cell *matCellDef="let submission">
            <div class="assignment-info">
              <span class="assignment-title">{{ submission.assignmentId?.title }}</span>
              <small>Max: {{ submission.assignmentId?.maxMarks }} marks</small>
            </div>
          </td>
        </ng-container>

        <!-- Subject Column -->
        <ng-container matColumnDef="subject">
          <th mat-header-cell *matHeaderCellDef>Subject</th>
          <td mat-cell *matCellDef="let submission">
            <div class="subject-info">
              <span>{{ submission.assignmentId?.subject?.name }}</span>
              <small>{{ submission.assignmentId?.subject?.code }}</small>
            </div>
          </td>
        </ng-container>

        <!-- Submitted At Column -->
        <ng-container matColumnDef="submittedAt">
          <th mat-header-cell *matHeaderCellDef>Submitted At</th>
          <td mat-cell *matCellDef="let submission">
            <div class="date-cell">
              <mat-icon>schedule</mat-icon>
              <span>{{ formatDate(submission.submittedAt) }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Marks Column -->
        <ng-container matColumnDef="marks">
          <th mat-header-cell *matHeaderCellDef>Marks</th>
          <td mat-cell *matCellDef="let submission">
            <div class="marks-cell">
              <span *ngIf="submission.marks !== null" class="marks-value">
                {{ submission.marks }} / {{ submission.assignmentId?.maxMarks }}
              </span>
              <span *ngIf="submission.marks === null" class="marks-na">N/A</span>
            </div>
          </td>
        </ng-container>

        <!-- Percentage Column -->
        <ng-container matColumnDef="percentage">
          <th mat-header-cell *matHeaderCellDef>Score</th>
          <td mat-cell *matCellDef="let submission">
            <div class="percentage-cell">
              <span *ngIf="submission.percentage !== null" class="percentage-value">
                {{ submission.percentage?.toFixed(1) }}%
              </span>
              <span *ngIf="submission.percentage === null" class="percentage-na">-</span>
            </div>
          </td>
        </ng-container>

        <!-- Level Column -->
        <ng-container matColumnDef="level">
          <th mat-header-cell *matHeaderCellDef>Level</th>
          <td mat-cell *matCellDef="let submission">
            <mat-chip *ngIf="submission.level" [class]="getLevelBadgeClass(submission.level)">
              {{ submission.level | titlecase }}
            </mat-chip>
            <span *ngIf="!submission.level" class="no-level">-</span>
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let submission">
            <mat-chip [class]="getEvaluationStatusClass(submission.evaluationStatus)">
              {{ getEvaluationStatusLabel(submission.evaluationStatus) }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let submission">
            <div class="action-buttons">
              <button mat-icon-button [matTooltip]="'View Details'" (click)="viewSubmissionDetails(submission)">
                <mat-icon>visibility</mat-icon>
              </button>
              <button 
                mat-icon-button 
                [matTooltip]="'Evaluate'" 
                (click)="evaluateSubmission(submission)"
                color="primary"
                *ngIf="submission.evaluationStatus === 'pending'">
                <mat-icon>rate_review</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
      </table>

      <!-- No Data -->
      <div *ngIf="submissions.length === 0 && !loading" class="no-data">
        <mat-icon>inbox</mat-icon>
        <h3>No submissions found</h3>
        <p>There are no submissions matching your filters.</p>
      </div>
    </div>

    <!-- Paginator -->
    <mat-paginator
      [length]="totalSubmissions"
      [pageSize]="pageSize"
      [pageSizeOptions]="[5, 10, 25, 50]"
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
  </mat-card>
</div>
