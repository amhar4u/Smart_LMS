<app-admin-layout>
  <div class="manage-modules-container">
    <!-- Header Card -->
    <mat-card class="header-card">
      <mat-card-header>
        <div class="header-content">
          <div class="header-text">
            <mat-card-title>
              <mat-icon>view_module</mat-icon>
              Manage Modules
            </mat-card-title>
            <mat-card-subtitle>
              Create and manage educational modules with documents and videos
            </mat-card-subtitle>
          </div>
          <div class="header-actions">
            <button 
              mat-raised-button 
              color="accent" 
              class="create-btn"
              (click)="openCreateDialog()">
              <mat-icon>add</mat-icon>
              Create Module
            </button>
          </div>
        </div>
      </mat-card-header>
    </mat-card>

  <!-- Filters Section -->
  <mat-card class="filters-card">
    <mat-card-content>
      <form [formGroup]="filterForm" class="filters-form">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search modules</mat-label>
          <input matInput formControlName="search" placeholder="Search by name, code, or description">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="subject-field">
          <mat-label>Filter by Subject</mat-label>
          <mat-select formControlName="subject">
            <mat-option value="">All Subjects</mat-option>
            <mat-option *ngFor="let subject of subjects" [value]="subject._id">
              {{ subject.name }} ({{ subject.code }})
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-button type="button" (click)="clearFilters()" class="clear-filters-btn">
          <mat-icon>clear</mat-icon>
          Clear Filters
        </button>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Modules Table -->
  <mat-card class="table-card">
    <mat-card-content>
      <!-- Loading Spinner -->
      <div *ngIf="loading" class="loading-container">
        <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
        <p>Loading modules...</p>
      </div>

      <!-- Table -->
      <div *ngIf="!loading" class="table-container">
        <table mat-table [dataSource]="modules" class="modules-table">
          
          <!-- Code Column -->
          <ng-container matColumnDef="code">
            <th mat-header-cell *matHeaderCellDef class="code-column">Code</th>
            <td mat-cell *matCellDef="let module" class="code-cell">
              <span class="module-code">{{ module.code }}</span>
            </td>
          </ng-container>

          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef class="name-column">Module Name</th>
            <td mat-cell *matCellDef="let module" class="name-cell">
              <div class="module-info">
                <span class="module-name">{{ module.name }}</span>
                <span class="module-description">{{ module.description }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Subject Column -->
          <ng-container matColumnDef="subject">
            <th mat-header-cell *matHeaderCellDef class="subject-column">Subject</th>
            <td mat-cell *matCellDef="let module" class="subject-cell">
              <div class="subject-info">
                <span class="subject-name">{{ module.subject?.name }}</span>
                <span class="subject-code">{{ module.subject?.code }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Documents Column -->
          <ng-container matColumnDef="documents">
            <th mat-header-cell *matHeaderCellDef class="documents-column">Documents</th>
            <td mat-cell *matCellDef="let module" class="documents-cell">
              <div class="documents-info">
                <mat-chip-set>
                  <mat-chip class="document-chip">
                    <mat-icon matChipAvatar>{{ getFileIcon('pdf') }}</mat-icon>
                    {{ getDocumentCount(module) }} files
                  </mat-chip>
                </mat-chip-set>
              </div>
            </td>
          </ng-container>

          <!-- Video Column -->
          <ng-container matColumnDef="video">
            <th mat-header-cell *matHeaderCellDef class="video-column">Video</th>
            <td mat-cell *matCellDef="let module" class="video-cell">
              <div class="video-info">
                <mat-icon *ngIf="hasVideo(module)" class="video-icon available">videocam</mat-icon>
                <mat-icon *ngIf="!hasVideo(module)" class="video-icon unavailable">videocam_off</mat-icon>
                <span class="video-status">{{ hasVideo(module) ? 'Available' : 'No Video' }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Order Column -->
          <ng-container matColumnDef="order">
            <th mat-header-cell *matHeaderCellDef class="order-column">Order</th>
            <td mat-cell *matCellDef="let module" class="order-cell">
              <span class="order-number">{{ module.order }}</span>
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef class="status-column">Status</th>
            <td mat-cell *matCellDef="let module" class="status-cell">
              <mat-chip-set>
                <mat-chip [class]="module.isActive ? 'status-active' : 'status-inactive'">
                  {{ module.isActive ? 'Active' : 'Inactive' }}
                </mat-chip>
              </mat-chip-set>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="actions-column">Actions</th>
            <td mat-cell *matCellDef="let module" class="actions-cell">
              <button mat-icon-button [matMenuTriggerFor]="actionsMenu" matTooltip="More actions">
                <mat-icon>more_vert</mat-icon>
              </button>
              
              <mat-menu #actionsMenu="matMenu">
                <button mat-menu-item (click)="openDetailsDialog(module)">
                  <mat-icon>visibility</mat-icon>
                  <span>View Details</span>
                </button>
                
                <button mat-menu-item (click)="openEditDialog(module)">
                  <mat-icon>edit</mat-icon>
                  <span>Edit Module</span>
                </button>
                
                <button mat-menu-item (click)="toggleModuleStatus(module)">
                  <mat-icon>{{ module.isActive ? 'toggle_off' : 'toggle_on' }}</mat-icon>
                  <span>{{ module.isActive ? 'Deactivate' : 'Activate' }}</span>
                </button>
                
                <mat-divider></mat-divider>
                
                <button mat-menu-item (click)="deleteModule(module)" class="delete-action">
                  <mat-icon>delete</mat-icon>
                  <span>Delete Module</span>
                </button>
              </mat-menu>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <!-- No Data Message -->
        <div *ngIf="modules.length === 0" class="no-data">
          <mat-icon>view_module</mat-icon>
          <h3>No modules found</h3>
          <p>{{ searchTerm || selectedSubject ? 'Try adjusting your filters or search terms.' : 'Start by creating your first module.' }}</p>
          <button *ngIf="!searchTerm && !selectedSubject" mat-raised-button color="primary" (click)="openCreateDialog()">
            <mat-icon>add</mat-icon>
            Create First Module
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Pagination -->
  <mat-paginator 
    *ngIf="!loading && modules.length > 0"
    [length]="totalItems"
    [pageSize]="itemsPerPage"
    [pageSizeOptions]="[5, 10, 25, 50]"
    [pageIndex]="currentPage - 1"
    (page)="onPageChange($event)"
    showFirstLastButtons>
  </mat-paginator>
</div>
</app-admin-layout>
